import React, { useEffect } from "react";
import qz from "qz-tray";

// Paste your certificate here
const CERT = `
-----BEGIN CERTIFICATE-----
......+......+...+..........+..+.+...+..+++++++++++++++++++++++++++++++++++++++*.....+...+....+...+..+......+...................+...+..+...+............+...+..........+...+++++++++++++++++++++++++++++++++++++++*.+...+.+.....+...............+...+...+...+.+..................+......+...........+...+...+....+...+.....+.+......+...+.....+..........+..+.+........+..........+..+.........+...+......+....+...+...+..+............+.......+.....+....+......+...+......+..+............+............+......+....+...........+..........+...+.....+..........+.........+.....+................+.....+....+.....+...............+.+......+......+.........+...+........+.......+......+.........+...............+.....+.......+...+..+....+.....+.+.....+....+..+.......+..+.+.....+...+......+...............+...+...............+.+.........+...........................+......+..+.+...........+.+..+...+....+..............+......+....+.........+..+................+..+...+.........+...+.+...........+...+......+......+.+..+..........+...............+..+....+......+...+.....+...+....+.....................+...+......+........+.+.....+.+......+........+.......+...+..+.......+.....+.......+...........+...+.+..................+.....+......................+......+..+......+....+...............+......+..+.........+....+.....+.+.........+......+.....................+..+.+.....+....+...........++++++
...+.+.....+++++++++++++++++++++++++++++++++++++++*..........+....+...+......+.....+....+...+.....+....+..................+......+......+...+..+.+..+.............+..+++++++++++++++++++++++++++++++++++++++*....+.....................+...+......+.....+......+.........+....+...+..+......+.+......+...............+..+...+....+........+...+...............+...+.+.....+.+...+..............+...+...+............+.......+..+.+........+......+..........+.........+.....+........................+.+...........+................+.....+...+.+.........+.....+....+...+.........+........+.............+..++++++
-----

-----END CERTIFICATE-----
`;

const QzPrint = ({ styleNumber, size }) => {
  useEffect(() => {
    printTag();
  }, []);

  const printTag = async () => {
    try {
      qz.security.setCertificatePromise(() => Promise.resolve(CERT));

      // ⚠️ Fake signature – for DEV/TEST only
      qz.security.setSignaturePromise((data) => {
        return Promise.resolve(btoa(data));
      });

      qz.websocket.setLogLevel("debug");
      await qz.websocket.connect();

      // Show available printers in console
      const printers = await qz.printers.find();
      console.log("Available printers:", printers);

      const config = qz.configs.create(printers[0]); // Use default printer

      const tspl = [
        "SIZE 100 mm, 50 mm",
        "GAP 3 mm, 0 mm",
        "DENSITY 7",
        "SPEED 4",
        "DIRECTION 1",
        "REFERENCE 0,0",
        "CLS",
        `TEXT 10,10,"3",0,1,1,"Product: ${styleNumber}"`,
        `TEXT 10,40,"3",0,1,1,"Size: ${size}"`,
        `TEXT 10,70,"3",0,1,1,"QZ Tray Print"`,
        "PRINT 1,1"
      ];

      await qz.print(config, tspl);
      await qz.websocket.disconnect();
    } catch (error) {
      console.error("Printing error:", error);
    }
  };

  return null; // No UI needed
};

export default QzPrint;
